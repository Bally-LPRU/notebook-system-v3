<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Equipment Collections</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      max-width: 800px;
      margin: 50px auto;
      padding: 20px;
      background: #f5f5f5;
    }
    .container {
      background: white;
      padding: 30px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    h1 {
      color: #333;
      margin-bottom: 20px;
    }
    button {
      background: #4CAF50;
      color: white;
      border: none;
      padding: 12px 24px;
      font-size: 16px;
      border-radius: 4px;
      cursor: pointer;
      margin-bottom: 20px;
    }
    button:hover {
      background: #45a049;
    }
    button:disabled {
      background: #ccc;
      cursor: not-allowed;
    }
    #results {
      background: #f9f9f9;
      padding: 15px;
      border-radius: 4px;
      border-left: 4px solid #4CAF50;
      white-space: pre-wrap;
      font-family: 'Courier New', monospace;
      font-size: 14px;
      line-height: 1.6;
    }
    .loading {
      color: #666;
      font-style: italic;
    }
    .error {
      color: #d32f2f;
      border-left-color: #d32f2f;
    }
    .success {
      color: #2e7d32;
    }
    .warning {
      color: #f57c00;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üîç ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Equipment Collections</h1>
    <button id="checkBtn" onclick="checkCollections()">‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö</button>
    <div id="results"></div>
  </div>

  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
    import { 
      getFirestore, 
      collection, 
      getDocs, 
      getCountFromServer,
      query,
      limit 
    } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

    // Firebase config from environment
    const firebaseConfig = {
      apiKey: "AIzaSyBqJqJqJqJqJqJqJqJqJqJqJqJqJqJqJqJ",
      authDomain: "equipment-lending-system-41b49.firebaseapp.com",
      projectId: "equipment-lending-system-41b49",
      storageBucket: "equipment-lending-system-41b49.firebasestorage.app",
      messagingSenderId: "123456789012",
      appId: "1:123456789012:web:abcdef1234567890abcdef"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    window.checkCollections = async function() {
      const resultsDiv = document.getElementById('results');
      const checkBtn = document.getElementById('checkBtn');
      
      resultsDiv.innerHTML = '<div class="loading">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö...</div>';
      checkBtn.disabled = true;

      try {
        let output = 'üîç ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö collections...\n\n';

        // Check equipment collection
        output += 'üì¶ Collection: equipment\n';
        const equipmentRef = collection(db, 'equipment');
        const equipmentQuery = query(equipmentRef, limit(5));
        const equipmentSnapshot = await getDocs(equipmentQuery);
        output += `   ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£ (‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á): ${equipmentSnapshot.size}\n`;
        
        if (!equipmentSnapshot.empty) {
          output += '   ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•:\n';
          equipmentSnapshot.forEach(doc => {
            const data = doc.data();
            output += `   - ${doc.id}: ${data.name || data.equipmentNumber || '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ä‡∏∑‡πà‡∏≠'}\n`;
          });
        } else {
          output += '   ‚ö†Ô∏è  ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•\n';
        }

        // Get total count
        const equipmentCountSnapshot = await getCountFromServer(equipmentRef);
        const equipmentCount = equipmentCountSnapshot.data().count;
        output += `   ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: ${equipmentCount}\n\n`;

        // Check equipmentManagement collection
        output += 'üì¶ Collection: equipmentManagement\n';
        const equipmentMgmtRef = collection(db, 'equipmentManagement');
        const equipmentMgmtQuery = query(equipmentMgmtRef, limit(5));
        const equipmentMgmtSnapshot = await getDocs(equipmentMgmtQuery);
        output += `   ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£ (‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á): ${equipmentMgmtSnapshot.size}\n`;
        
        if (!equipmentMgmtSnapshot.empty) {
          output += '   ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•:\n';
          equipmentMgmtSnapshot.forEach(doc => {
            const data = doc.data();
            output += `   - ${doc.id}: ${data.name || data.equipmentNumber || '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ä‡∏∑‡πà‡∏≠'}\n`;
          });
        } else {
          output += '   ‚ö†Ô∏è  ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•\n';
        }

        // Get total count
        const equipmentMgmtCountSnapshot = await getCountFromServer(equipmentMgmtRef);
        const equipmentMgmtCount = equipmentMgmtCountSnapshot.data().count;
        output += `   ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: ${equipmentMgmtCount}\n\n`;

        // Summary
        output += 'üìä ‡∏™‡∏£‡∏∏‡∏õ:\n';
        output += `   equipment: ${equipmentCount} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£\n`;
        output += `   equipmentManagement: ${equipmentMgmtCount} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£\n\n`;
        
        if (equipmentCount > 0 && equipmentMgmtCount === 0) {
          output += '‚ö†Ô∏è  ‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô equipment ‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÉ‡∏ô equipmentManagement\n';
          output += 'üí° ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥: ‡∏ï‡πâ‡∏≠‡∏á‡∏¢‡πâ‡∏≤‡∏¢‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å equipment ‡πÑ‡∏õ‡∏¢‡∏±‡∏á equipmentManagement\n';
          resultsDiv.className = 'warning';
        } else if (equipmentCount === 0 && equipmentMgmtCount === 0) {
          output += '‚ö†Ô∏è  ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡πÉ‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏≠‡∏á collections\n';
          output += 'üí° ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥: ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ú‡πà‡∏≤‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå\n';
          resultsDiv.className = 'warning';
        } else if (equipmentMgmtCount > 0) {
          output += '‚úÖ ‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô equipmentManagement ‡πÅ‡∏•‡πâ‡∏ß\n';
          resultsDiv.className = 'success';
        }

        resultsDiv.innerHTML = output;

      } catch (error) {
        console.error('Error:', error);
        resultsDiv.innerHTML = `‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î:\n${error.message}\n\n‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Firebase config ‡πÅ‡∏•‡∏∞ Firestore rules`;
        resultsDiv.className = 'error';
      } finally {
        checkBtn.disabled = false;
      }
    };
  </script>
</body>
</html>
